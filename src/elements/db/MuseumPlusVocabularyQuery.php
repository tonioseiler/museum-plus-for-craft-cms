<?php

namespace furbo\museumplusforcraftcms\elements\db;
use \craft\elements\db\ElementQuery;
use craft\db\Query;
use craft\db\Table;
use craft\helpers\Db;

class MuseumPlusVocabularyQuery extends ElementQuery
{
    public $type;
    public $collectionId;
    public $language;
    public $parentId;

    public function collectionId($value)
    {
        $this->collectionId = $value;

        return $this;
    }

    public function type($value)
    {
        $this->type = $value;

        return $this;
    }

    public function language($value)
    {
        $this->language = $value;

        return $this;
    }

    public function parentId($value)
    {
        $this->parentId = $value;

        return $this;
    }

    protected function beforePrepare(): bool
    {
        // join in the items table
        $this->joinElementTable('museumplus_vocabulary');

        // select the collection id column
        $this->query->select([
            'museumplus_vocabulary.collectionId',
            'museumplus_vocabulary.data',
            'museumplus_vocabulary.type',
            'museumplus_vocabulary.language',
            'museumplus_vocabulary.parentId',
        ]);

        if ($this->collectionId) {
            $this->subQuery->andWhere(Db::parseParam('museumplus_vocabulary.collectionId', $this->collectionId));
        }

        if ($this->type) {
            $this->subQuery->andWhere(Db::parseParam('museumplus_vocabulary.type', $this->type));
        }

        if ($this->language) {
            $this->subQuery->andWhere(Db::parseParam('museumplus_vocabulary.language', $this->language));
        }

        if ($this->parentId) {
            $this->subQuery->andWhere(Db::parseParam('museumplus_vocabulary.parentId', $this->parentId));
        }

        return parent::beforePrepare(); // TODO: Change the autogenerated stub
    }
}